/* Copyright 2019 SiFive, Inc */
/* SPDX-License-Identifier: Apache-2.0 */

#include <stdio.h>
#include <stdint.h>
#include "hbird_sdk_soc.h"


#define L 3
#define LL 9

#define R 4294967296
#define Prime 3329
#define Prime_inv_neg 1806234369

//#define BarrettV 
//#define LenN 128
//#define LenN_inv 3303
//#define LenN_inv_Rfield 1441
//#define LenN_inv_R2_Rfield 2208
//#define INV2 

//#define R2_MODP 546993
int16_t matrixA[256] = {
		928,1933,3101,602,2846,480,1066,3156,387,2495,1834,1945,2998,3071,512,2011,1195,3103,2464,1978,1285,1649,3119,1231,2261,1007,2397,407,1858,364,446,1884,2861,250,3035,3017,1275,2580,337,552,1342,3105,822,1701,812,1489,1063,3226,2815,1118,651,2083,1562,1816,2370,2701,1110,2796,2873,622,1175,714,2853,845,323,2314,2853,2344,636,731,406,3211,1353,1247,3097,1425,450,2213,3033,669,1473,2788,2355,1503,1970,564,3066,1315,20,3215,3151,2646,2119,844,908,468,2491,3150,432,42,459,1036,966,2736,664,2235,634,1021,2082,2888,288,1528,558,301,1458,302,2914,672,2537,2128,261,687,2280,1797,550,1065,2141,1992,2579,929,174,2697,2307,3208,458,663,2487,2437,1888,241,402,260,19,2716,2070,1956,1110,2599,2702,840,877,2217,628,3245,1391,2752,2605,1522,2487,2503,3162,413,198,105,881,832,87,1041,1336,975,73,1798,983,981,2711,1697,2223,3002,1954,2826,1160,2118,409,2318,621,1160,408,98,113,947,1297,1285,1133,2211,312,543,1610,919,2832,3276,272,899,1431,986,4,45,1797,423,1462,2917,355,960,3255,1655,949,1728,2660,3185,1852,2510,2110,1570,1009,2585,1508,3058,1304,311,2341,3094,104,641,690,343,179,1953,2860,2892,1650,1590,1024,819,738,2256,2262,867,1099,1422,720,1488,1519,546,2550,3317,1780,933
};
int16_t matrixB[256] = {
		928,1933,3101,602,2846,480,1066,3156,387,2495,1834,1945,2998,3071,512,2011,1195,3103,2464,1978,1285,1649,3119,1231,2261,1007,2397,407,1858,364,446,1884,2861,250,3035,3017,1275,2580,337,552,1342,3105,822,1701,812,1489,1063,3226,2815,1118,651,2083,1562,1816,2370,2701,1110,2796,2873,622,1175,714,2853,845,323,2314,2853,2344,636,731,406,3211,1353,1247,3097,1425,450,2213,3033,669,1473,2788,2355,1503,1970,564,3066,1315,20,3215,3151,2646,2119,844,908,468,2491,3150,432,42,459,1036,966,2736,664,2235,634,1021,2082,2888,288,1528,558,301,1458,302,2914,672,2537,2128,261,687,2280,1797,550,1065,2141,1992,2579,929,174,2697,2307,3208,458,663,2487,2437,1888,241,402,260,19,2716,2070,1956,1110,2599,2702,840,877,2217,628,3245,1391,2752,2605,1522,2487,2503,3162,413,198,105,881,832,87,1041,1336,975,73,1798,983,981,2711,1697,2223,3002,1954,2826,1160,2118,409,2318,621,1160,408,98,113,947,1297,1285,1133,2211,312,543,1610,919,2832,3276,272,899,1431,986,4,45,1797,423,1462,2917,355,960,3255,1655,949,1728,2660,3185,1852,2510,2110,1570,1009,2585,1508,3058,1304,311,2341,3094,104,641,690,343,179,1953,2860,2892,1650,1590,1024,819,738,2256,2262,867,1099,1422,720,1488,1519,546,2550,3317,1780,933
};
int16_t matrixD[256]={181, 1337, 3248, 1364, 2540, 793, 1371, 2228, 481, 45, 2299, 2128, 1559, 114, 1420, 3194, 3188, 1190, 2368, 2270, 530, 3094, 415, 3248, 2587, 2742, 802, 2771, 2280, 3015, 131, 893, 821, 1284, 1765, 262, 2765, 379, 1302, 2777, 2557, 1302, 3135, 719, 833, 1126, 57, 2651, 2346, 407, 2789, 3071, 46, 64, 1764, 2590, 2378, 1676, 2561, 1148, 879, 1191, 2507, 2832, 12, 894, 3318, 2182, 2441, 905, 423, 716, 3001, 1943, 1978, 2139, 515, 95, 3063, 875, 1837, 1909, 2452, 1804, 2543, 2258, 23, 2911, 2727, 1039, 1346, 2101, 1933, 840, 1168, 2465, 3105, 1339, 338, 2264, 2259, 999, 2448, 2404, 2861, 243, 1525, 1379, 2821, 252, 2369, 448, 2984, 1074, 2327, 3026, 1349, 1161, 2139, 1969, 2106, 2071, 1990, 3308, 1692, 2391, 3192, 2022, 1784, 732, 2419, 296, 486, 990, 2180, 2989, 681, 2731, 532, 1123, 486, 1129, 2584, 2203, 2361, 961, 417, 7, 2833, 2156, 1203, 3016, 2385, 308, 3126, 2697, 1390, 2586, 801, 313, 2132, 164, 316, 2408, 1418, 1544, 1446, 705, 2219, 2406, 1001, 1660, 2735, 2111, 173, 2427, 330, 1713, 973, 2979, 568, 846, 1378, 1454, 2003, 2540, 2009, 3257, 958, 892, 2860, 617, 2301, 438, 3097, 1906, 193, 1455, 3124, 2718, 3225, 3171, 777, 2408, 1179, 436, 3167, 1529, 2057, 12, 2522, 2700, 2269, 2029, 2029, 701, 134, 1991, 1621, 3022, 1778, 2115, 1309, 2625, 652, 1498, 3018, 1030, 3295, 2131, 1566, 1978, 13, 1022, 779, 1162, 2867, 1591, 1760, 926, 1292, 2408, 3102, 2431, 2499, 992, 3324, 2101, 693, 2998, 2699, 2265, 2040, 2042, 2606, 459};


int16_t root_table_Rfield_1234[15] = {
		2379, 1948, 2473, 2609, 166, 3311, 2168, 2087,
		3116, 1467, 3074, 1030, 3184, 858, 2077
};

int16_t root_table_Rfield_567[112] = {
		1008, 1524, 1757, 3027, 495, 3155, 2093,
		1765, 371, 2291, 1076, 2822, 3023, 237,
		691, 1647, 1368, 2189, 3037, 1636, 2323,
		2957, 1456, 700, 865, 864, 1270, 2019,
		3265, 594, 1694, 491, 44, 1760, 334,
		2530, 1180, 2872, 2241, 3062, 2636, 243,
		1330, 1389, 1372, 2118, 122, 1551, 1834,
		2560, 1616, 1033, 3036, 2740, 3072, 1733,
		1887, 1689, 748, 2605, 3237, 2978, 2328,
		203, 3288, 2349, 1367, 3282, 1449, 1913,
		1462, 1478, 2119, 111, 2166, 86, 2218,
		1087, 1535, 802, 310, 21, 840, 916,
		1941, 2716, 2074, 2081, 2729, 2632, 3314,
		357, 3064, 1217, 1823, 2733, 2792, 318,
		964, 1677, 3303, 2895, 1968, 2153, 715,
		2256, 2289, 2829, 1877, 2887, 2294, 1487
};

int16_t root_table_Rfield[127] = {
		2379, 1948, 2473, 2609, 166, 3311, 2168, 2087,
		3116, 1467, 3074, 1030, 3184, 858, 2077,
		1008, 1524, 1757, 3027, 495, 3155, 2093,
		1765, 371, 2291, 1076, 2822, 3023, 237,
		691, 1647, 1368, 2189, 3037, 1636, 2323,
		2957, 1456, 700, 865, 864, 1270, 2019,
		3265, 594, 1694, 491, 44, 1760, 334,
		2530, 1180, 2872, 2241, 3062, 2636, 243,
		1330, 1389, 1372, 2118, 122, 1551, 1834,
		2560, 1616, 1033, 3036, 2740, 3072, 1733,
		1887, 1689, 748, 2605, 3237, 2978, 2328,
		203, 3288, 2349, 1367, 3282, 1449, 1913,
		1462, 1478, 2119, 111, 2166, 86, 2218,
		1087, 1535, 802, 310, 21, 840, 916,
		1941, 2716, 2074, 2081, 2729, 2632, 3314,
		357, 3064, 1217, 1823, 2733, 2792, 318,
		964, 1677, 3303, 2895, 1968, 2153, 715,
		2256, 2289, 2829, 1877, 2887, 2294, 1487
};

int16_t root_table_Rfield_pairwise[128] = {
		3027, 302, 495, 2834, 3155, 174, 2093, 1236,
		1076, 2253, 2822, 507, 3023, 306, 237, 3092,
		2189, 1140, 3037, 292, 1636, 1693, 2323, 1006,
		865, 2464, 864, 2465, 1270, 2059, 2019, 1310,
		491, 2838, 44, 3285, 1760, 1569, 334, 2995,
		2241, 1088, 3062, 267, 2636, 693, 243, 3086,
		2118, 1211, 122, 3207, 1551, 1778, 1834, 1495,
		3036, 293, 2740, 589, 3072, 257, 1733, 1596,
		2605, 724, 3237, 92, 2978, 351, 2328, 1001,
		1367, 1962, 3282, 47, 1449, 1880, 1913, 1416,
		111, 3218, 2166, 1163, 86, 3243, 2218, 1111,
		310, 3019, 21, 3308, 840, 2489, 916, 2413,
		2081, 1248, 2729, 600, 2632, 697, 3314, 15,
		1823, 1506, 2733, 596, 2792, 537, 318, 3011,
		2895, 434, 1968, 1361, 2153, 1176, 715, 2614,
		1877, 1452, 2887, 442, 2294, 1035, 1487, 1842
};

int16_t root_table_forInverse_Rfield_765[112] = {
		1073, 500, 1040, 1842, 1035, 442, 1452,
		2365, 26, 1652, 2614, 1176, 1361, 434,
		2972, 2112, 265, 3011, 537, 596, 1506,
		1388, 1255, 613, 15, 697, 600, 1248,
		2242, 2527, 1794, 2413, 2489, 3308, 3019,
		1867, 1210, 1851, 1111, 3243, 1163, 3218,
		3126, 980, 41, 1416, 1880, 47, 1962,
		1442, 2581, 1640, 1001, 351, 92, 724,
		769, 2296, 1713, 1596, 257, 589, 293,
		1999, 1957, 1940, 1495, 1778, 3207, 1211,
		799, 457, 2149, 3086, 693, 267, 1088,
		64, 1635, 2735, 2995, 1569, 3285, 2838,
		372, 2629, 1873, 1310, 2059, 2465, 2464,
		2638, 1961, 1682, 1006, 1693, 292, 1140,
		1564, 1038, 2958, 3092, 306, 507, 2253,
		2321, 1572, 1805, 1236, 174, 2834, 302
};

int16_t root_table_forInverse_Rfield_4321[15] = {
		950, 856, 1381, 1161, 18, 3163, 720, 1252,
		2471, 145, 2299, 255, 1862, 213, 1242
};

int16_t root_table_forInverse_Rfield[127] = {
		1073, 500, 1040, 1842, 1035, 442, 1452,
		2365, 26, 1652, 2614, 1176, 1361, 434,
		2972, 2112, 265, 3011, 537, 596, 1506,
		1388, 1255, 613, 15, 697, 600, 1248,
		2242, 2527, 1794, 2413, 2489, 3308, 3019,
		1867, 1210, 1851, 1111, 3243, 1163, 3218,
		3126, 980, 41, 1416, 1880, 47, 1962,
		1442, 2581, 1640, 1001, 351, 92, 724,
		769, 2296, 1713, 1596, 257, 589, 293,
		1999, 1957, 1940, 1495, 1778, 3207, 1211,
		799, 457, 2149, 3086, 693, 267, 1088,
		64, 1635, 2735, 2995, 1569, 3285, 2838,
		372, 2629, 1873, 1310, 2059, 2465, 2464,
		2638, 1961, 1682, 1006, 1693, 292, 1140,
		1564, 1038, 2958, 3092, 306, 507, 2253,
		2321, 1572, 1805, 1236, 174, 2834, 302,
		950, 856, 1381, 1161, 18, 3163, 720, 1252,
		2471, 145, 2299, 255, 1862, 213, 1242
};

int16_t result[256] = {0};

//20210923整合的函数
extern void polyBaseMul(int16_t *, int16_t *, int16_t * , int16_t * );
extern void NTT_forward(int16_t *, int16_t * );
extern void NTT_backward(int16_t *, int16_t * );

unsigned int begin_ntt_ma, begin_ntt_mb, begin_basemul, begin_intt, begin_i_twist;
unsigned int end_ntt_ma, end_ntt_mb, end_basemul, end_intt, end_i_twist;

void main(void) {

	int i;
    
	begin_ntt_ma =__get_rv_cycle();
	NTT_forward(matrixA, root_table_Rfield);
	end_ntt_ma =__get_rv_cycle();
	printf("cycle_count_ntt(MA) is %d\n", end_ntt_ma - begin_ntt_ma);
    
	begin_ntt_mb =__get_rv_cycle();
	NTT_forward(matrixB, root_table_Rfield);
	end_ntt_mb =__get_rv_cycle();
	printf("cycle_count_ntt(MB) is %d\n", end_ntt_mb - begin_ntt_mb);

	begin_basemul =__get_rv_cycle();
	polyBaseMul(matrixA, matrixB, result, root_table_Rfield_pairwise);
	end_basemul =__get_rv_cycle();
	printf("cycle_count_Basemul is %d\n", end_basemul - begin_basemul);

	begin_intt =__get_rv_cycle();
	NTT_backward(result, root_table_forInverse_Rfield);
	end_intt =__get_rv_cycle();
        printf("cycle_count_INTT is %d\n", end_intt - begin_intt);

	
	printf("******************************************************************\n");
	printf("*********************check_7-1*********************************************\n");
	for(i = 0; i < 256; i++){
		printf("%10d\t%10d,", i,result[i]-matrixD[i]);
		printf("\n");
		}
}
