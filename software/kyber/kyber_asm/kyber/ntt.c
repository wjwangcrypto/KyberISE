#include <stdio.h>
#include <stdint.h>
#include "params.h"
#include "ntt.h"


int16_t root_table_Rfield_1234[15] = {
		2379, 1948, 2473, 2609, 166, 3311, 2168, 2087,
		3116, 1467, 3074, 1030, 3184, 858, 2077
};

int16_t root_table_Rfield_567[112] = {
		1008, 1524, 1757, 3027, 495, 3155, 2093,
		1765, 371, 2291, 1076, 2822, 3023, 237,
		691, 1647, 1368, 2189, 3037, 1636, 2323,
		2957, 1456, 700, 865, 864, 1270, 2019,
		3265, 594, 1694, 491, 44, 1760, 334,
		2530, 1180, 2872, 2241, 3062, 2636, 243,
		1330, 1389, 1372, 2118, 122, 1551, 1834,
		2560, 1616, 1033, 3036, 2740, 3072, 1733,
		1887, 1689, 748, 2605, 3237, 2978, 2328,
		203, 3288, 2349, 1367, 3282, 1449, 1913,
		1462, 1478, 2119, 111, 2166, 86, 2218,
		1087, 1535, 802, 310, 21, 840, 916,
		1941, 2716, 2074, 2081, 2729, 2632, 3314,
		357, 3064, 1217, 1823, 2733, 2792, 318,
		964, 1677, 3303, 2895, 1968, 2153, 715,
		2256, 2289, 2829, 1877, 2887, 2294, 1487
};

int16_t root_table_Rfield[127] = {
		2379, 1948, 2473, 2609, 166, 3311, 2168, 2087,
		3116, 1467, 3074, 1030, 3184, 858, 2077,
		1008, 1524, 1757, 3027, 495, 3155, 2093,
		1765, 371, 2291, 1076, 2822, 3023, 237,
		691, 1647, 1368, 2189, 3037, 1636, 2323,
		2957, 1456, 700, 865, 864, 1270, 2019,
		3265, 594, 1694, 491, 44, 1760, 334,
		2530, 1180, 2872, 2241, 3062, 2636, 243,
		1330, 1389, 1372, 2118, 122, 1551, 1834,
		2560, 1616, 1033, 3036, 2740, 3072, 1733,
		1887, 1689, 748, 2605, 3237, 2978, 2328,
		203, 3288, 2349, 1367, 3282, 1449, 1913,
		1462, 1478, 2119, 111, 2166, 86, 2218,
		1087, 1535, 802, 310, 21, 840, 916,
		1941, 2716, 2074, 2081, 2729, 2632, 3314,
		357, 3064, 1217, 1823, 2733, 2792, 318,
		964, 1677, 3303, 2895, 1968, 2153, 715,
		2256, 2289, 2829, 1877, 2887, 2294, 1487
};

int16_t root_table_Rfield_pairwise[128] = {
		3027, 302, 495, 2834, 3155, 174, 2093, 1236,
		1076, 2253, 2822, 507, 3023, 306, 237, 3092,
		2189, 1140, 3037, 292, 1636, 1693, 2323, 1006,
		865, 2464, 864, 2465, 1270, 2059, 2019, 1310,
		491, 2838, 44, 3285, 1760, 1569, 334, 2995,
		2241, 1088, 3062, 267, 2636, 693, 243, 3086,
		2118, 1211, 122, 3207, 1551, 1778, 1834, 1495,
		3036, 293, 2740, 589, 3072, 257, 1733, 1596,
		2605, 724, 3237, 92, 2978, 351, 2328, 1001,
		1367, 1962, 3282, 47, 1449, 1880, 1913, 1416,
		111, 3218, 2166, 1163, 86, 3243, 2218, 1111,
		310, 3019, 21, 3308, 840, 2489, 916, 2413,
		2081, 1248, 2729, 600, 2632, 697, 3314, 15,
		1823, 1506, 2733, 596, 2792, 537, 318, 3011,
		2895, 434, 1968, 1361, 2153, 1176, 715, 2614,
		1877, 1452, 2887, 442, 2294, 1035, 1487, 1842
};

int16_t root_table_forInverse_Rfield_765[112] = {
		1073, 500, 1040, 1842, 1035, 442, 1452,
		2365, 26, 1652, 2614, 1176, 1361, 434,
		2972, 2112, 265, 3011, 537, 596, 1506,
		1388, 1255, 613, 15, 697, 600, 1248,
		2242, 2527, 1794, 2413, 2489, 3308, 3019,
		1867, 1210, 1851, 1111, 3243, 1163, 3218,
		3126, 980, 41, 1416, 1880, 47, 1962,
		1442, 2581, 1640, 1001, 351, 92, 724,
		769, 2296, 1713, 1596, 257, 589, 293,
		1999, 1957, 1940, 1495, 1778, 3207, 1211,
		799, 457, 2149, 3086, 693, 267, 1088,
		64, 1635, 2735, 2995, 1569, 3285, 2838,
		372, 2629, 1873, 1310, 2059, 2465, 2464,
		2638, 1961, 1682, 1006, 1693, 292, 1140,
		1564, 1038, 2958, 3092, 306, 507, 2253,
		2321, 1572, 1805, 1236, 174, 2834, 302
};

int16_t root_table_forInverse_Rfield_4321[15] = {
		950, 856, 1381, 1161, 18, 3163, 720, 1252,
		2471, 145, 2299, 255, 1862, 213, 1242
};

int16_t root_table_forInverse_Rfield[127] = {
		1073, 500, 1040, 1842, 1035, 442, 1452,
		2365, 26, 1652, 2614, 1176, 1361, 434,
		2972, 2112, 265, 3011, 537, 596, 1506,
		1388, 1255, 613, 15, 697, 600, 1248,
		2242, 2527, 1794, 2413, 2489, 3308, 3019,
		1867, 1210, 1851, 1111, 3243, 1163, 3218,
		3126, 980, 41, 1416, 1880, 47, 1962,
		1442, 2581, 1640, 1001, 351, 92, 724,
		769, 2296, 1713, 1596, 257, 589, 293,
		1999, 1957, 1940, 1495, 1778, 3207, 1211,
		799, 457, 2149, 3086, 693, 267, 1088,
		64, 1635, 2735, 2995, 1569, 3285, 2838,
		372, 2629, 1873, 1310, 2059, 2465, 2464,
		2638, 1961, 1682, 1006, 1693, 292, 1140,
		1564, 1038, 2958, 3092, 306, 507, 2253,
		2321, 1572, 1805, 1236, 174, 2834, 302,
		950, 856, 1381, 1161, 18, 3163, 720, 1252,
		2471, 145, 2299, 255, 1862, 213, 1242
};

/*************************************************
* Name:        ntt
*
* Description: Inplace number-theoretic transform (NTT) in Rq
*              input is in standard order, output is in bitreversed order
*
* Arguments:   - int16_t r[256]: pointer to input/output vector of elements
*                                of Zq
**************************************************/

void ntt(int16_t r[256]) {

 NTT_forward(r, root_table_Rfield);

}
 
/* unsigned int len, start, j, k;
  int16_t t, zeta;

  k = 1;
  for(len = 128; len >= 2; len >>= 1) {
    for(start = 0; start < 256; start = j + len) {
      zeta = zetas[k++];
      for(j = start; j < start + len; ++j) {
        t = fqmul(zeta, r[j + len]);
        r[j + len] = r[j] - t;
        r[j] = r[j] + t;
      }
    }
  }*/



/*************************************************
* Name:        invntt_tomont
*
* Description: Inplace inverse number-theoretic transform in Rq and
*              multiplication by Montgomery factor 2^16.
*              Input is in bitreversed order, output is in standard order
*
* Arguments:   - int16_t r[256]: pointer to input/output vector of elements
*                                of Zq
**************************************************/

void invntt(int16_t r[256]) {
   NTT_backward(r, root_table_forInverse_Rfield);

  /*unsigned int start, len, j, k;
  int16_t t, zeta;

  k = 0;
  for(len = 2; len <= 128; len <<= 1) {
    for(start = 0; start < 256; start = j + len) {
      zeta = zetas_inv[k++];
      for(j = start; j < start + len; ++j) {
        t = r[j];
        r[j] = barrett_reduce(t + r[j + len]);
        r[j + len] = t - r[j + len];
        r[j + len] = fqmul(zeta, r[j + len]);
      }
    }
  }

  for(j = 0; j < 256; ++j)
    r[j] = fqmul(r[j], zetas_inv[127]);*/
}

/*************************************************
* Name:        basemul
*
* Description: Multiplication of polynomials in Zq[X]/(X^2-zeta)
*              used for multiplication of elements in Rq in NTT domain
*
* Arguments:   - int16_t r[2]:       pointer to the output polynomial
*              - const int16_t a[2]: pointer to the first factor
*              - const int16_t b[2]: pointer to the second factor
*              - int16_t zeta:       integer defining the reduction polynomial
**************************************************/



void basemul(int16_t r[256],int16_t a[256],int16_t b[256]){
		BaseMul(a, b, root_table_Rfield_pairwise, r);
                printf("basemul:\n");
                printf("basemul_r = ");
  		for(int i=0; i<KYBER_N; i++){
    			printf("%d,",r[i]);
  		}
  		printf("\n");
}
     
